{% extends "base.html" %}
{% block title %}Detail Lengkap Mahasiswa - PDDIKTI Clone{% endblock %}
{% block content %}

<!-- Loading State -->
{% if not detail and not error %}
<div class="row">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-body text-center py-5">
                <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h4 class="mb-3">Memuat Data Detail Mahasiswa</h4>
                <div class="progress mb-3" style="width: 300px; margin: 0 auto;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                        style="width: 100%"></div>
                </div>
                <p class="text-muted">Mohon tunggu, sedang mengambil data lengkap dari server...</p>
                <small class="text-muted">Ini mungkin memakan waktu 10-15 detik</small>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if error %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Error:</strong> {{ error | safe }}
        </div>
    </div>
</div>
{% elif detail and detail.get('data') and detail.data.get('mahasiswa') %}
{% set mhs = detail.data.mahasiswa %}
{% set terdaftar = mhs.terdaftar %}
<div class="row">
    <div class="col-12">
        <!-- Header Card -->
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">
                        <i class="fas fa-user-graduate"></i> Detail Lengkap Mahasiswa
                    </h3>
                    <a href="javascript:history.back()" class="btn btn-light btn-sm">
                        <i class="fas fa-arrow-left"></i> Kembali
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h4 class="text-primary mb-3">{{ mhs.nama or 'Nama tidak tersedia' }}</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong><i class="fas fa-id-card"></i> NIM:</strong><br>
                                    <span class="text-primary">{{ terdaftar.nim or 'Tidak tersedia' }}</span>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <p><strong><i class="fas fa-venus-mars"></i> Jenis Kelamin:</strong><br>
                                    <span class="text-secondary">{{ mhs.jenis_kelamin or 'Tidak tersedia' }}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="bg-light rounded p-3">
                            <i class="fas fa-user-graduate fa-3x text-primary mb-2"></i>
                            <p class="mb-0 text-muted">Mahasiswa</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personal Information -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card shadow h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-user"></i> Informasi Pribadi
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong><i class="fas fa-id-card"></i> NIK:</strong><br>
                            <span class="text-secondary">{{ mhs.nik or 'Tidak tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-map-marker-alt"></i> Tempat Lahir:</strong><br>
                            <span class="text-secondary">{{ mhs.tempat_lahir or 'Tidak tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-calendar"></i> Tanggal Lahir:</strong><br>
                            <span class="text-secondary">{{ mhs.tgl_lahir or 'Tidak tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-female"></i> Nama Ibu:</strong><br>
                            <span class="text-secondary">{{ mhs.ibu_kandung or 'Tidak tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-flag"></i> Kewarganegaraan:</strong><br>
                            <span class="text-secondary">{{ mhs.kewarganegaraan or 'Tidak tersedia' }}</span>
                        </div>
                        {% if mhs.agama %}
                        <div class="mb-3">
                            <strong><i class="fas fa-pray"></i> Agama:</strong><br>
                            <span class="text-secondary">{{ mhs.agama.nama or 'Tidak tersedia' }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-phone"></i> Informasi Kontak
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong><i class="fas fa-phone"></i> Telepon:</strong><br>
                            <span class="text-secondary">{{ mhs.telepon or 'Tidak tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-mobile-alt"></i> Handphone:</strong><br>
                            <span class="text-primary">{{ mhs.handphone or 'Tidak tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-envelope"></i> Email:</strong><br>
                            <span class="text-info">{{ mhs.email or 'Tidak tersedia' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Address Information -->
        {% if mhs.alamat %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-map-marker-alt"></i> Informasi Alamat
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <strong><i class="fas fa-road"></i> Jalan:</strong><br>
                                    <span class="text-secondary">{{ mhs.alamat.jalan or 'Tidak tersedia' }}</span>
                                </div>
                                <div class="mb-3">
                                    <strong><i class="fas fa-home"></i> RT/RW:</strong><br>
                                    <span class="text-secondary">{{ mhs.alamat.rt or '0' }}/{{ mhs.alamat.rw or '0'
                                        }}</span>
                                </div>
                                <div class="mb-3">
                                    <strong><i class="fas fa-map"></i> Dusun:</strong><br>
                                    <span class="text-secondary">{{ mhs.alamat.dusun or 'Tidak tersedia' }}</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <strong><i class="fas fa-building"></i> Kelurahan:</strong><br>
                                    <span class="text-secondary">{{ mhs.alamat.kelurahan or 'Tidak tersedia' }}</span>
                                </div>
                                <div class="mb-3">
                                    <strong><i class="fas fa-map-pin"></i> Kode Pos:</strong><br>
                                    <span class="text-secondary">{{ mhs.alamat.kode_pos or 'Tidak tersedia' }}</span>
                                </div>
                                {% if mhs.alamat.kab_kota %}
                                <div class="mb-3">
                                    <strong><i class="fas fa-city"></i> Kabupaten/Kota:</strong><br>
                                    <span class="text-secondary">{{ mhs.alamat.kab_kota.nama or 'Tidak tersedia'
                                        }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Academic Information -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card shadow h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-university"></i> Informasi Akademik
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong><i class="fas fa-university"></i> Perguruan Tinggi:</strong><br>
                            <span class="text-primary">{{ terdaftar.nama_pt or 'Tidak tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-graduation-cap"></i> Program Studi:</strong><br>
                            <span class="text-info">{{ terdaftar.nama_prodi or 'Tidak tersedia' }}</span>
                        </div>
                        {% if terdaftar.jenjang_didik %}
                        <div class="mb-3">
                            <strong><i class="fas fa-certificate"></i> Jenjang:</strong><br>
                            <span class="badge bg-primary">{{ terdaftar.jenjang_didik.nama or 'Tidak tersedia' }}</span>
                        </div>
                        {% endif %}
                        <div class="mb-3">
                            <strong><i class="fas fa-calendar-alt"></i> Tanggal Masuk:</strong><br>
                            <span class="text-secondary">{{ terdaftar.tgl_masuk or 'Tidak tersedia' }}</span>
                        </div>
                        {% if terdaftar.tgl_keluar %}
                        <div class="mb-3">
                            <strong><i class="fas fa-calendar-times"></i> Tanggal Keluar:</strong><br>
                            <span class="text-secondary">{{ terdaftar.tgl_keluar or 'Tidak tersedia' }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line"></i> Status Akademik
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong><i class="fas fa-star"></i> IPK:</strong><br>
                            <span class="h4 text-success">{{ "%.2f"|format(terdaftar.ipk) if terdaftar.ipk else 'Tidak
                                tersedia' }}</span>
                        </div>
                        <div class="mb-3">
                            <strong><i class="fas fa-calendar"></i> Semester Mulai:</strong><br>
                            <span class="text-secondary">{{ terdaftar.smt_mulai or 'Tidak tersedia' }}</span>
                        </div>
                        {% if terdaftar.jenis_daftar %}
                        <div class="mb-3">
                            <strong><i class="fas fa-user-plus"></i> Jenis Daftar:</strong><br>
                            <span class="text-secondary">{{ terdaftar.jenis_daftar.nama or 'Tidak tersedia' }}</span>
                        </div>
                        {% endif %}
                        {% if terdaftar.jenis_keluar and terdaftar.jenis_keluar.ket %}
                        <div class="mb-3">
                            <strong><i class="fas fa-user-times"></i> Jenis Keluar:</strong><br>
                            <span class="text-secondary">{{ terdaftar.jenis_keluar.ket or 'Tidak tersedia' }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Last Update -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-clock"></i> Informasi Update
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <strong><i class="fas fa-info-circle"></i> Last Update:</strong>
                            <span class="h6">{{ mhs.last_update or 'Tidak tersedia' }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-body text-center">
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <h4>Data Tidak Ditemukan</h4>
                <p class="text-muted">Detail lengkap mahasiswa tidak dapat ditemukan atau tidak tersedia.</p>
                <a href="javascript:history.back()" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> Kembali
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}